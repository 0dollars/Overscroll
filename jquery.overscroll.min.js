(function(l,n,e,b){b=e.fn.overscroll=function(a){a=a||{};return this.each(function(){b.init(e(this),a)})};b=e.fn.removeOverscroll=function(){return this.each(function(){var a=e(this).data(b.removerKey);e.isFunction(a)&&a()})};e.extend(b,{events:{wheel:"mousewheel DOMMouseScroll",start:"select mousedown touchstart",drag:"mousemove touchmove",end:"mouseup mouseleave touchend",ignored:"dragstart drag"},div:"<div/>",removerKey:"overscroll-remover",constants:{driftFrequency:40,driftSequences:22,driftDecay:1.15,
driftTimeout:100,timeout:400,captureThreshold:3,wheelDelta:20,scrollDelta:15,thumbThickness:8,thumbOpacity:0.7,boundingBox:1E6},checkIosDevice:function(){if(b.isIOS===undefined)b.isIOS=/iP((hone)|(ad)|(od))/.test(navigator.platform);return b.isIOS},init:function(a,c){var d={sizing:b.getSizing(a)};c=e.extend({showThumbs:true,wheelDirection:"vertical",cursor:"move",wheelDelta:b.constants.wheelDelta,scrollDelta:b.constants.scrollDelta,direction:"multi",cancelOn:""},c);if(c.direction!=="multi"&&c.direction!==
c.wheelDirection)c.wheelDirection=c.direction;c.scrollDelta=n.abs(c.scrollDelta);c.wheelDelta=n.abs(c.wheelDelta);a.removeOverscroll();a.data(b.removerKey,b.remover(a,d));a.css({position:"relative",overflow:"hidden",cursor:c.cursor}).bind(b.events.wheel,d,b.wheel).bind(b.events.start,d,b.start).bind(b.events.end,d,b.stop).bind(b.events.ignored,false);if(c.showThumbs){d.thumbs={};if(d.sizing.container.scrollWidth>0&&c.direction!=="vertical"){d.thumbs.horizontal=e(b.div).css(b.getThumbCss(d.sizing.thumbs.horizontal)).fadeTo(0,
0);a.prepend(d.thumbs.horizontal)}if(d.sizing.container.scrollHeight>0&&c.direction!=="horizontal"){d.thumbs.vertical=e(b.div).css(b.getThumbCss(d.sizing.thumbs.vertical)).fadeTo(0,0);a.prepend(d.thumbs.vertical)}}d.target=a;d.options=c},remover:function(a,c){return function(){a.css({overflow:"auto",cursor:"default"}).unbind(b.events.wheel,b.wheel).unbind(b.events.start,c,b.start).unbind(b.events.end,c,b.stop).unbind(b.events.ignored,false);if(c.thumbs){c.thumbs.horizontal&&c.thumbs.horizontal.remove();
c.thumbs.vertical&&c.thumbs.vertical.remove()}}},triggerEvent:function(a,c){c.target.trigger("overscroll:"+a)},toggleThumbs:function(a,c){if(a.thumbs)if(c){a.thumbs.vertical&&a.thumbs.vertical.stop(true,true).fadeTo("fast",b.constants.thumbOpacity);a.thumbs.horizontal&&a.thumbs.horizontal.stop(true,true).fadeTo("fast",b.constants.thumbOpacity)}else{a.thumbs.vertical&&a.thumbs.vertical.fadeTo("fast",0);a.thumbs.horizontal&&a.thumbs.horizontal.fadeTo("fast",0)}},setPosition:function(a,c,d){c.x=a.pageX;
c.y=a.pageY;c.time=b.time();c.index=d;return c},wheel:function(a,c){b.clearInterval(a.data.target);if(a.wheelDelta)c=a.wheelDelta/(l.opera?-120:120);if(a.detail)c=-a.detail/3;if(!a.data.wheelCapture){a.data.wheelCapture={timeout:null};b.toggleThumbs(a.data,true);a.data.target.stop(true,true).data("dragging",true)}c*=a.data.options.wheelDelta;if(a.data.options.wheelDirection==="horizontal")this.scrollLeft-=c;else this.scrollTop-=c;b.moveThumbs(a,this.scrollLeft,this.scrollTop);a.data.wheelCapture.timeout&&
clearTimeout(a.data.wheelCapture.timeout);a.data.wheelCapture.timeout=setTimeout(function(){a.data.wheelCapture=undefined;b.toggleThumbs(a.data,false);a.data.target.data("dragging",false)},b.constants.timeout);return false},moveThumbs:function(a,c,d,g,f,h,i){if(a.data.options.showThumbs){g=a.data.thumbs;f=a.data.sizing;if(g.horizontal){h=c*(1+f.container.width/f.container.scrollWidth);i=d+f.thumbs.horizontal.top;g.horizontal.css("margin",i+"px 0 0 "+h+"px")}if(g.vertical){h=c+f.thumbs.vertical.left;
i=d*(1+f.container.height/f.container.scrollHeight);g.vertical.css("margin",i+"px 0 0 "+h+"px")}}},start:function(a){b.clearInterval(a.data.target);if(!e(a.target).is(a.data.options.cancelOn)){b.normalizeEvent(a);a.data.target.bind(b.events.drag,a.data,b.drag).stop(true,true).data("dragging",false);a.data.position=b.setPosition(a,{});a.data.capture=b.setPosition(a,{},2);b.triggerEvent("dragstart",a.data);return false}},drag:function(a){b.normalizeEvent(a);a.data.target.data("dragging")||b.toggleThumbs(a.data,
true);if(a.data.options.direction!=="vertical")this.scrollLeft-=a.pageX-a.data.position.x;if(a.data.options.direction!=="horizontal")this.scrollTop-=a.pageY-a.data.position.y;b.moveThumbs(a,this.scrollLeft,this.scrollTop);b.setPosition(a,a.data.position);if(--a.data.capture.index<=0){a.data.target.data("dragging",true);b.setPosition(a,a.data.capture,b.constants.captureThreshold)}return true},normalizeEvent:function(a){if(b.checkIosDevice()){var c=a.originalEvent.changedTouches[0];a.pageX=c.pageX;
a.pageY=c.pageY}},time:function(){return(new Date).getTime()},stop:function(a){if(a.data.position){a.data.target.unbind(b.events.drag,b.drag);b.triggerEvent("dragend",a.data);if(a.data.target.data("dragging"))b.drift(this,a,function(c){c.target.data("dragging",false);b.toggleThumbs(c,false)});else{a.data.target.data("dragging",false);b.toggleThumbs(a.data,false)}a.data.capture=a.data.position=undefined}return!a.data.target.data("dragging")},clearInterval:function(a){a=e(a);var c=a.data("overscroll-interval");
c&&l.clearInterval(c);a.data("overscroll-interval",null)},setInterval:function(a,c){b.clearInterval(a);e(a).data("overscroll-interval",c)},drift:function(a,c,d){if(b.time()-c.data.capture.time>b.constants.driftTimeout)return d.call(null,c.data);b.normalizeEvent(c);var g=c.data.options.scrollDelta*(c.pageX-c.data.capture.x),f=c.data.options.scrollDelta*(c.pageY-c.data.capture.y),h=a.scrollLeft,i=a.scrollTop,j=g/b.constants.driftSequences,k=f/b.constants.driftSequences,o=b.constants.driftDecay;if(c.data.options.direction!==
"vertical")h-=g;if(c.data.options.direction!=="horizontal")i-=f;b.triggerEvent("driftstart",c.data);b.setInterval(a,l.setInterval(function(){var m=true;if(k>1&&a.scrollTop>i||k<-1&&a.scrollTop<i){m=false;a.scrollTop-=k;k/=o}if(j>1&&a.scrollLeft>h||j<-1&&a.scrollLeft<h){m=false;a.scrollLeft-=j;j/=o}b.moveThumbs(c,a.scrollLeft,a.scrollTop);if(m){b.clearInterval(a);b.triggerEvent("driftend",c.data);d.call(null,c.data)}},b.constants.driftFrequency))},getSizing:function(a){var c={left:a.scrollLeft(),top:a.scrollTop()},
d={};d.container={width:a.width(),height:a.height()};a.scrollLeft(b.constants.boundingBox).scrollTop(b.constants.boundingBox);d.container.scrollWidth=a.scrollLeft();d.container.scrollHeight=a.scrollTop();a.scrollTop(0).scrollLeft(0);d.thumbs={horizontal:{width:d.container.width*d.container.width/d.container.scrollWidth,height:b.constants.thumbThickness,corner:b.constants.thumbThickness/2,left:0,top:d.container.height-b.constants.thumbThickness},vertical:{width:b.constants.thumbThickness,height:d.container.height*
d.container.height/d.container.scrollHeight,corner:b.constants.thumbThickness/2,left:d.container.width-b.constants.thumbThickness,top:0}};d.container.width-=d.thumbs.horizontal.width;d.container.height-=d.thumbs.vertical.height;a.scrollTop(c.top).scrollLeft(c.left);return d},getThumbCss:function(a){return{position:"absolute","background-color":"black",width:a.width+"px",height:a.height+"px",margin:a.top+"px 0 0 "+a.left+"px","-moz-border-radius":a.corner+"px","-webkit-border-radius":a.corner+"px",
"border-radius":a.corner+"px"}}})})(window,Math,jQuery);
